stages:
  - build
  - test
  - sonar
  - deploy


build:
  stage: build
  script:
    - cd Software/Backend
    - gradle build -x test

test:
  stage: test
  script:
    - cd Software/Backend
    - gradle test

#cypress:
#  image: node:latest
#  stage: cypress
#  script:
#    # install dependencies
#    - npm ci --legacy-peer-deps
#    # start the server in the background
#    - npm run start:ci &
#    # run Cypress tests
#    - npm run e2e

sonar:
  stage: sonar
  script:
    - cd Software/Backend
    - gradle sonarqube -D "sonar.projectKey=Individual-Track-Spring" -D "sonar.host.url=http://localhost:9000" -D "sonar.login=sqp_899cd355780972c2cdc5ebbc676f85933507c446"

deploy:
  stage: deploy
  script:
    - cd Software
    - docker-compose up -d
    - docker ps

after_script:
  - echo "End CI"
  - exit
